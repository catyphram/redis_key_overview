<html style="height:100%;">
	</head>
		<title>Redis Key Overview</title>
		<link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css">
		<script src="//code.jquery.com/jquery-1.11.0.min.js"></script>
	</head>
	<body style="height:100%; background-color: #eee;" >
		<div class="jumbotron" style="height:100%;">
			<div class="container">
				<div class="page-header">
					<h1><a href="/static/keyoverview.html" style="color: #333333;">Redis Key Overview</a><button type="button" style="margin-left: 60px" id="init-btn" class="btn btn-primary">Initialize Views</button></h1>
				</div>
				<div id="msgs" style="margin-top: 50px; width:100%; height: 400px"></div>
			</div>
		</div>
	</body>
	<script>
		function _requestStatusPercent() {
			$.ajax("/initstatuspercent").done(function(data, textstatus, jqXHR){
				$("#percent").html("Status: " + data + " %")
				if(data !== 100){
					_requestStatusPercent()
				}
			}).fail(function(jqXHR, textstatus, error){
				if(jqXHR.status === 404){
					_requestStatusPercent()
				}else if(jqXHR.status !== 423){
					console.log("Unknowed Error!")
				}
			})
		}

		function _requestStatus(){
			$.ajax("/initstatus").done(function(data, textstatus, jqXHR){
				if(data === "FIN"){
					$('#msgs').append("<p>FINISHED</p>")
					$('#msgs').append("<a class='btn btn-primary' href='/static/keyoverview.html'>Show Overview</a>")
				}else{
					if(data === "STATUS"){
						$('#percent').removeAttr('id')
						$('#msgs').append("<p id='percent'><p>")
						_requestStatusPercent()
					}else{
						$('#msgs').append("<p>"+data+"<p>")
					}
					_requestStatus()
				}
			}).fail(function(jqXHR, textstatus, error){
				if(jqXHR.status === 404){
					_requestStatus()
				}else if(jqXHR.status !== 423){
					console.log("Unknowed Error!")
				}
			})
		}

		$("#init-btn").on( 'click', function( evt ){
			console.log(arguments)
			$.ajax("/init").done(function(data, textstatus, jqXHR){
				_requestStatus();
			}).fail(function(jqXHR, textstatus, error){
				$('#msgs').append("<p>" + jqXHR.responseText + "</p>")
			})
		})
	</script
</html>